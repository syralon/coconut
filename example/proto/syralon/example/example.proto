syntax = "proto3";

package syralon.example;

import "google/api/annotations.proto";
import "google/protobuf/descriptor.proto";
import "syralon/coconut/field/field.proto";
import "syralon/coconut/field/paginator.proto";
import "buf/validate/validate.proto";

option go_package = "github.com/syralon/coconut/example/proto/syralon/example;example";

enum BookOrder {
  BookOrderByID = 0;
}


message Book {
  string title = 1;
  string abstract = 2;
}

message BookShelf {
  string name = 1;
  repeated Book books = 2;
}

message CreateBookRequest {
  string title = 1[(buf.validate.field).required= true];
  string abstract = 2[(buf.validate.field).required= true];
}

message CreateBookResponse {
  Book data = 1;
}

message ListBookOrder {
  BookOrder by = 1;
  bool desc = 2;
}

message ListBookRequest {
  syralon.coconut.field.Paginator paginator = 1;
  repeated ListBookOrder orders = 2;
  repeated syralon.coconut.field.Int64Field id = 3;
  repeated syralon.coconut.field.StringField title = 4;
}

message ListBookResponse {
  syralon.coconut.field.Paginator paginator = 1;
  repeated Book data = 2;
}

service BookService {
  // Create a new book
  rpc Create(CreateBookRequest) returns (CreateBookResponse) {
    option (google.api.http) = {
      post: "/api/books"
      body: "*"
    };
  }
  // List books
  rpc List(ListBookRequest) returns (ListBookResponse) {
    option (google.api.http) = {get: "/api/books"};
  }
}

message CreateBookShelfRequest {
  string name = 1[(buf.validate.field).required= true];
  repeated int64 book_ids = 2;
}

message CreateBookShelfResponse {
  BookShelf data = 1;
}

message ListBookShelfRequest {
  syralon.coconut.field.Paginator paginator = 1;
  syralon.coconut.field.Int64Field id = 2;
  syralon.coconut.field.StringField name = 3;
  bool with_books = 4;
}

message ListBookShelfResponse {
  syralon.coconut.field.Paginator paginator = 1;
  repeated BookShelf data = 2;
}

service BookShelfService {
  rpc Create(CreateBookShelfRequest) returns (CreateBookShelfResponse) {
    option (google.api.http) = {
      post: "/api/bookshelves"
      body: "*"
    };
  }
  rpc List(ListBookShelfRequest) returns (ListBookShelfResponse) {
    option (google.api.http) = {get: "/api/bookshelves"};
  }
}
